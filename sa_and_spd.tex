\section[SA \& SPD]{Security Association (SA) and Security Policy Database (SPD)}

Sowohl AH als auch ESP müssen an einem gewissen Punkt im Netzwerk eine Veränderung an IP-Paketen vornehmen. Die involvierten IPSec-Knoten bilden Sender-Empfänger-Paare; der Sender verändert ein IP-Paket, der Empfänger macht die Veränderung rückgängig. Die Beziehung zwischen Sender um Empfänger wir durch eine Security Association (SA) beschrieben.\newline Eine SA beschreibt also nur genau eine Transformation und die zugehörige Rücktransformation. Beim Einsatz mehrerer Sicherheitsdienste müssen daher auch mehrere SA's aufgebaut werden.\newline
Eine SA wird durch einen Security Parameter Index (SPI, 32 bits), die Ziel-Adresse und einen Security Protocol Identifier (zur Bezeichnung des Sicherheitsverfahrens - AH oder ESP) festgelegt.\newline Der Sender schreibt den SPI in das entsprechende Feld der IP-Protokoll-Erweiterung und der Empfänger kann dann mit Hilfe dieser Information die richtige Security Association identifizieren und kann so die zuvor vorgenommene Transformation rückgängig machen und auf das ursprüngliche Paket zugreifen.\newline Jede kommunizierende Einheit kann in beliebig viele Sicherheitsverbindungen (SA's) involviert sein. Die Spezifikationen der Sicherheitsverfahren sind in jedem IPSec-Knoten lokal in der sogenannten Security Policy Database (SPD) gespeichert. Die SPD enthält verschiedene Einträge für ein- und ausgehenden Datenverkehr. Durch die SPD wird bestimmt, ob ein Datenstrom verschlüsselt werden muss oder im Klartext übertragen werden kann. Wenn verschlüsselte Daten versendet werden, muss die SPD eine Referenz auf die entsprechende SA haben.